<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Connexion</title>
  <link rel="stylesheet" href="thoth.css"> <!-- ton fichier CSS -->
  <script src="https://cdn.backendless.com/sdk/js/latest/backendless.min.js"></script>
</head>
<body>
  <div class="login-container">
    <h2>Connexion par Matricule</h2>
    
    <form id="loginForm">
      <input type="text" id="matricule" placeholder="Matricule" required><br><br>
      <button type="submit">Se connecter</button>
    </form>

    <p id="loginMessage"></p>
  </div>

  <script>
    const APP_ID = "B4A3DE5F-5247-43FC-8831-C87303139B55";
    const API_KEY = "0D40C30E-CC67-4C67-B532-1BF5BB94BCC4";
    const TABLE = "utilisateurs"; // ta table Backendless

    document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const matricule = document.getElementById("matricule").value.trim();
      const message = document.getElementById("loginMessage");

      message.textContent = "Vérification en cours...";

      try {
        const response = await fetch(
          `https://api.backendless.com/${APP_ID}/${API_KEY}/data/${TABLE}?where=matricule%3D'${matricule}'`
        );
        const data = await response.json();

        if (data.length > 0) {
          localStorage.setItem("userSession", JSON.stringify(data[0]));
          message.textContent = "Connexion réussie ✅ Redirection...";
          
          setTimeout(() => {
            window.location.href = "login.html";
          }, 1000);
        } else {
          message.textContent = "Matricule incorrect ❌";
        }
      } catch (error) {
        message.textContent = "Erreur de connexion : " + error.message;
      }
    });
  </script>
</body>
</html>

